<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8">
        <title>내 냉장고</title>
        <link rel="stylesheet" href="6_recipe.css">
    </head>
    <body>
        <header>
            <a href="4_main.html">
                <img id="logo" src="logo.png" alt="Logo">
            </a>
            <input id="search-bar" type="text" placeholder="레시피 검색...">
            <div id="user-name">사용자 이름
                <div class="dropdown-icon">&#9660;</div>
            </div>
        </header>
        <nav>
            <a href="6_recipe.html">냉장고</a>
            <a href="8_myrecipes.html">내 레시피</a>
            <a href="7_newrecipe.html">레시피 만들기</a>
            <a href="9_commincation.html">소통</a>
            <a href="10_qna.html">문의 사항</a>
        </nav>
        <div class="content">
            <div class="form-section">
                <h3>냉장고 리스트 추가</h3>
                <form id="fridge-form">
                    <input type="text" id="ingredient-name" placeholder="재료" required>
                    <input type="text" id="ingredient-quantity" placeholder="양" required>
                    <select id="ingredient-unit">
                        <option value="g">그램(g)</option>
                        <option value="kg">킬로그램(kg)</option>
                        <option value="ml">밀리리터(ml)</option>
                        <option value="l">리터(l)</option>
                        <!-- More units as required -->
                    </select>
                    <input type="date" id="expiration-date" required>
                    <button type="submit">추가</button>
                </form>
            </div>
            <div class="fridge-list">
                <h3>내 냉장고 리스트</h3>
                <table class="fridge-table">
                    <thead>
                        <tr>
                            <th>재료</th>
                            <th>양</th>
                            <th>단위</th>
                            <th>유통기한</th>
                            <th>수정</th>
                            <th>삭제</th>
                        </tr>
                    </thead>
                    <tbody id="fridge-list-items">
                        <!-- List items will be added here with JavaScript -->
                    </tbody>
                </table>
            </div>

            <div class="content">
                <button id="searchRecipes" onclick="searchIngredient()">검색</button>
            </div>
        </div>
        <div class="container">
            <div id="recipe-results"></div>
        </div>
        <div id="progress-container">
            <div id="progress-bar" style="width: 0%; height: 15px; background-color: #4CAF50;"></div>
            <div id="progress-percentage" style="display: none;">0%</div>
        </div>
        <div  class="scroll-container">
            <img id="to-top" src="scroll.png" onclick="go_top()" style="width: 50px; z-index: 9; display: none;">
            <!--<a href="https://kr.freepik.com/icon/down-arrow_152427#fromView=search&page=3&position=33&uuid=609ff4b8-2830-401f-9edb-980f8fd8866d">Freepik 제작 아이콘</a>-->
        </div>
        <script>
            document.getElementById('fridge-form').addEventListener('submit', function(event) {
                event.preventDefault();
            
                // 수정 모드인지 식별하기 위한 변수
                var isEditMode = document.getElementById('fridge-form').hasAttribute('data-editing-index');
                var ingredient = document.getElementById('ingredient-name').value;
                var quantity = document.getElementById('ingredient-quantity').value;
                var unit = document.getElementById('ingredient-unit').value;
                var expiration = document.getElementById('expiration-date').value;
            
                var list = document.getElementById('fridge-list-items');
                if (isEditMode) {
                    // 수정 모드일 경우
                    var editingIndex = document.getElementById('fridge-form').getAttribute('data-editing-index');
                    var row = list.children[editingIndex];
            
                    row.innerHTML = `
                        <td>${ingredient}</td>
                        <td>${quantity}</td>
                        <td>${unit}</td>
                        <td>${expiration}</td>
                        <td><button class="edit-btn">수정</button></td>
                        <td><button class="delete-btn">삭제</button></td>
                    `;
            
                    // 수정 모드 해제
                    document.getElementById('fridge-form').removeAttribute('data-editing-index');
                } else {
                    // 추가 모드일 경우
                    var row = document.createElement('tr');
                    
                    row.innerHTML = `
                        <td>${ingredient}</td>
                        <td>${quantity}</td>
                        <td>${unit}</td>
                        <td>${expiration}</td>
                        <td><button class="edit-btn">수정</button></td>
                        <td><button class="delete-btn">삭제</button></td>
                    `;
                    
                    list.appendChild(row);
                }
            
                // Reset the form fields
                document.getElementById('ingredient-name').value = '';
                document.getElementById('ingredient-quantity').value = '';
                document.getElementById('ingredient-unit').selectedIndex = 0; // 단위를 기본값으로 설정
                document.getElementById('expiration-date').value = '';

                saveFridgeList();
            
                // 삭제 버튼 이벤트 리스너
                row.querySelector('.delete-btn').addEventListener('click', function() {
                    list.removeChild(row);
                    saveFridgeList();
                });
            
                // 수정 버튼 이벤트 리스너
                row.querySelector('.edit-btn').addEventListener('click', function() {
                    // 입력 필드로 데이터 이동
                    document.getElementById('ingredient-name').value = ingredient;
                    document.getElementById('ingredient-quantity').value = quantity;
                    document.getElementById('ingredient-unit').value = unit;
                    document.getElementById('expiration-date').value = expiration;
            
                    // 수정 모드 활성화
                    var index = Array.from(list.children).indexOf(row);
                    document.getElementById('fridge-form').setAttribute('data-editing-index', index);
                });
            });

            function saveFridgeList() {
                var list = document.getElementById('fridge-list-items');
                var items = [];

                list.querySelectorAll('tr').forEach(row => {
                    var item = {
                        ingredient: row.cells[0].textContent,
                        quantity: row.cells[1].textContent,
                        unit: row.cells[2].textContent,
                        expiration: row.cells[3].textContent
                    };
                    items.push(item);
                });

                localStorage.setItem('fridgeList', JSON.stringify(items));
            }
            </script>
            <script src="6_recipe.js"></script>
    </body>
</html>
