<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>검색 결과</title>
    <link rel="stylesheet" href="6_recipe.css">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="Untree.co">
    <link rel="shortcut icon" href="LOGO.png">

    <meta name="description" content="" />
    <meta name="keywords" content="bootstrap, bootstrap5" />
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="fonts/icomoon/style.css">
    <link rel="stylesheet" href="fonts/flaticon/font/flaticon.css">

    <link rel="stylesheet" href="css/tiny-slider.css">
    <link rel="stylesheet" href="css/aos.css">
    <link rel="stylesheet" href="css/style.css">
    <style>
        .has-children:hover .dropdown {
            display: block;
        }
        .search-bar-container {
            position: relative;
            display: flex;
            align-items: center;
        }
        #search-icon-container {
            position: relative;
        }
        #search-icon {
            width: 24px; /* 돋보기 이미지 크기 */
            height: 24px; /* 돋보기 이미지 크기 */
            position: absolute;
            right: 15px; /* 검색 바 오른쪽 끝에 위치 */
            top: 50%;
            transform: translateY(-50%); /* 돋보기 이미지를 검색 바의 세로 중앙에 맞춤 */
            cursor: pointer;
            transition: transform 0.3s ease; /* 애니메이션 효과 추가 */
        }
        #search-bar {
            width: 100%;
            padding: 10px 40px 10px 15px; /* 우측 패딩 추가하여 아이콘 공간 확보 */
            border-radius: 25px;
            background-color: #fff;
            color: #333;
            font-size: 16px;
            outline: none;
            margin-right: 10px;
            transition: padding-right 0.3s ease; /* 입력 필드에 맞춰 패딩을 조정하는 애니메이션 효과 추가 */
        }

        #search-bar::placeholder {
            color: #ccc;
            font-size: 16px; /* placeholder 글자 크기 조정 */
        }

        .search-bar-container.active #search-icon {
            transform: translateX(-100%); /* 돋보기 이미지를 검색 바 안으로 이동 */
        }

        .search-bar-container.active #search-bar {
            padding-right: 15px; /* 검색 필드가 줄어들어 패딩을 초기화 */
        }
        .hero {
    position: relative; /* Ensure relative positioning for absolute children */
    
    background-size: cover; /* 화면을 꽉 채우도록 */
    background-position: center; /* 중앙 정렬 */
    height: 600px; /* 원하는 높이 설정 */
    display: flex;
    justify-content: center;
    align-items: center;
    text-align: center;
    color: #fff;
}

.hero-text {
    position: relative; /* Ensure text is placed relative to .hero */
    z-index: 1; /* Ensure text appears above background */
}

.breadcrumb {
    background: transparent; /* Breadcrumb 배경 투명하게 */
}

.breadcrumb-item {
    font-size: 18px; /* Breadcrumb 글꼴 크기 */
}

.breadcrumb-item a {
    color: #fff; /* Breadcrumb 링크 색상 */
    text-align: center;
}
.site-menu {
    display: flex; /* Use flexbox for horizontal alignment */
    align-items: center; /* Align items vertically in center */
    gap: 20px; /* Adjust spacing between items */
}

.site-menu li {
    list-style: none; /* Remove default list styling */
}

#login-menu {
    margin-left: auto; /* Push login menu to the far right */
}

#user-name-menu {
    display: none; /* Hide user name menu initially */
}

.recipe-description {
    color: #333;
}

    </style>
    <title>레시피 검색 홈페이지</title>
</head>
<body>
    <div class="site-mobile-menu site-navbar-target">
        <div class="site-mobile-menu-header">
            <div class="site-mobile-menu-close">
                <span class="icofont-close js-menu-toggle"></span>
            </div>
        </div>
        <div class="site-mobile-menu-body"></div>
    </div>

    <div class="site-nav">
        <div class="container">
            <div class="menu-bg-wrap">
                <div class="site-navigation" style="display: flex; justify-content: space-between; align-items: center;">
                    <div class="nav-left">
                        <a href="4_main.html" class="logo m-0 float-start">EatBooks</a>
                        <div class="search-bar-container">
                            <input id="search-bar" type="text" placeholder="레시피 검색..." onkeypress="if(event.key === 'Enter') performSearch(this.value)">
                            <img id="search-icon" src="search.png" alt="Search Icon" onclick="performSearch()"> 
                        </div>
                    </div>
                    <ul class="js-clone-nav d-none d-lg-inline-block text-start site-menu float-end">
                        
                        <li><a href="6_recipe.html">나만의 냉장고</a></li>
                        <li><a href="8_myrecipes.html">내 레시피</a></li>
                        <li><a href="7_newrecipe.html">레시피 만들기</a></li>
                        <li class="has-children">
                            <a href="#" class="no-link">게시판</a>
                            <ul class="dropdown">
                                <li><a href="9_communication.html">소통</a></li>
                                <li><a href="10_qna.html">문의사항</a></li>
                            </ul>
                        </li>
                    </ul>
                    <a href="#" class="burger light me-auto float-end mt-1 site-menu-toggle js-menu-toggle d-inline-block d-lg-none" data-toggle="collapse" data-target="#main-navbar">
                        <span></span>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="hero page-inner overlay" style="background-image: url('images/검색화면 배경.jpg');">
        <div class="container">
            <div class="row justify-content-center align-items-center">
                <div class="col-lg-9 text-center mt-5">
                    <h1 class="heading" data-aos="fade-up">검색 결과</h1>
                    <nav aria-label="breadcrumb" data-aos="fade-up" data-aos-delay="200">
                        <ol class="breadcrumb text-center justify-content-center">
                            <li class="breadcrumb-item "><a href="4_main.html">Home</a></li>
                            <li class="breadcrumb-item active text-white-50" aria-current="page">검색 결과</li>
                        </ol>
                    </nav>
                </div>
            </div>
        </div>
    </div>

    <div class="section">
        <div class="container">
            <div class="row mb-5 align-items-center">
                <div class="col-lg-6">
                    <h2 class="font-weight-bold text-primary heading">검색 결과</h2>
                </div>
                <div class="col-lg-6 text-lg-end">
                    <p><a href="4_main.html" class="btn btn-primary text-white py-3 px-4">홈으로</a></p>
                </div>
            </div>
            <div class="row" id="recipe-results" class="d-flex flex-wrap justify-content-center">
                <!-- 검색 결과가 여기에 표시됩니다 -->
            </div>
        </div>
    </div>

    <div id="progress-container">
        <div id="progress-bar" style="width: 0%; height: 15px; background-color: #4CAF50;"></div>
        <div id="progress-percentage" style="display: none;">0%</div>
    </div>
    <div class="scroll-container">
        <img id="to-top" src="scroll.png" onclick="go_top()" style="width: 50px; z-index: 9; display:none; padding-bottom: 20px;">
    </div>

    <div class="site-footer">
        <div class="container">
            <div class="row">
                <div class="col-lg-4">
                    <div class="widget">
                        <h3>Contact</h3>
                        <address>한경국립대학교 제1공학관 303호</address>
                        <ul class="list-unstyled links">
                            <li><a href="tel://031-670-5114">+82 31-670-5114</a></li>
                            <li><a href="tel://010-9035-0454">+82 10-9035-0454</a></li>
                            <li><a href="mailto:info@mydomain.com">doog0740@gmail.com</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="widget">
                        <h3>Menu bar</h3>
                        <ul class="list-unstyled float-start links">
                            <li><a href="6_recipe.html">My own refrigerator</a></li>
                            <li><a href="8_myrecipes.html">My recipe</a></li>
                            <li><a href="7_newrecipe.html">Making a recipe</a></li>
                        </ul>
                        <ul class="list-unstyled float-start links">
                            <li><a href="10_qna.html">Questions</a></li>
                            <li><a href="9_communication.html">Communication</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="widget">
                        <h3>Links</h3>
                        <ul class="list-unstyled social">
                            <li><a href="https://www.instagram.com/with_hknu/"><span class="icon-instagram"></span></a></li>
                            <li><a href="https://x.com/withhknu"><span class="icon-twitter"></span></a></li>
                            <li><a href="https://www.facebook.com/HankyungNationalUniv/"><span class="icon-facebook"></span></a></li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="row mt-5">
                <div class="col-12 text-center">
                    <p>Copyright &copy;<script>document.write(new Date().getFullYear());</script>. All Rights Reserved. &mdash; Designed with love by <a href="#">Untree.co</a></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const kakaoNickname = localStorage.getItem('kakaoNickname');
            if (kakaoNickname) {
                const userNameElement = document.getElementById('user-name');
                userNameElement.textContent = kakaoNickname;
            }
            const searchQuery = localStorage.getItem('searchQuery');
            if (searchQuery) {
                searchRecipe(searchQuery);
            }
        });

        function performSearch() {
            const searchValue = document.getElementById('search-bar').value;
            localStorage.setItem('searchQuery', searchValue);
            searchRecipe(searchValue);
        }

        async function searchRecipe(foodName) {
            const resultsContainer = document.getElementById('recipe-results');
            resultsContainer.innerHTML = ''; // 결과 컨테이너 초기화

            const results = await fetchFoodInfo(foodName);
            if (results.length > 0) {
                results.forEach(result => {
                    const recipeColumn = document.createElement('div');
                    recipeColumn.classList.add('recipe-column');

                    const recipeTitle = document.createElement('h2');
                    recipeTitle.textContent = result.name;
                    recipeColumn.appendChild(recipeTitle);

                    const recipeImage = document.createElement('img');
                    recipeImage.src = result.image;
                    recipeImage.alt = `이미지: ${result.name}`;
                    recipeColumn.appendChild(recipeImage);

                    const recipeAuthor = document.createElement('div');
                    recipeAuthor.textContent = "작성자: " + result.author;
                    recipeColumn.append(recipeAuthor);

                    const recipeDescription = document.createElement('div');
                    recipeDescription.classList.add('recipe-description');
                    recipeDescription.textContent = result.description;
                    recipeColumn.append(recipeDescription);

                    recipeColumn.addEventListener('click', () => {
                        // 로컬 스토리지에 레시피 정보 저장
                        localStorage.setItem('selectedRecipe', JSON.stringify(result));
                        // 새로운 페이지로 이동
                        window.location.href = '6_recipe_detail.html';
                    });
                    resultsContainer.appendChild(recipeColumn);

                    document.getElementById('progress-bar').style.display = 'none';
                    document.getElementById('progress-percentage').style.display = 'none';
                    document.getElementById('to-top').style.display = 'flex';
                });
            } else {
                resultsContainer.innerHTML = '음식 정보를 가져오는데 실패했습니다.';
            }
        }

        async function fetchFoodInfo(name) {
            const url = `https://cors-anywhere-o5bm.onrender.com/http://www.10000recipe.com/recipe/list.html?q=${name}`;
            const response = await fetch(url);
            const results = [];

            if (response.ok) {
                const html = await response.text();
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');

                const foodList = doc.querySelectorAll('.common_sp_link');
                if (foodList.length === 0) {
                    console.log("해당 음식에 대한 정보를 찾을 수 없습니다.");
                    return results;
                }

                const promises = Array.from(foodList).map(async food => {
                    const foodId = food.getAttribute('href').split('/').pop();
                    const newUrl = `https://cors-anywhere-o5bm.onrender.com/http://www.10000recipe.com/recipe/${foodId}`;
                    const newResponse = await fetch(newUrl);
                    
                    if (newResponse.ok) {
                        const newHtml = await newResponse.text();
                        const newDoc = parser.parseFromString(newHtml, 'text/html');
                        
                        const foodInfoElement = newDoc.querySelector('[type="application/ld+json"]');
                        if (!foodInfoElement) {
                            console.log(`레시피 정보 요소를 찾을 수 없습니다: ${newUrl}`);
                            return null;
                        }
                        
                        const result = JSON.parse(foodInfoElement.textContent);
                        const foodName = result.name;
                        const foodImg = result.image ? result.image[0] : '이미지 없음';
                        const author = result.author["name"];
                        const description = result.description;
                        const ingredient = result.recipeIngredient ? result.recipeIngredient.join(',') : '재료 정보 없음';
                        const recipeImg = Array.isArray(result.recipeInstructions) ? result.recipeInstructions.map((instruction, index) => 
                            `${index + 1}. ${instruction.image}`): [];
                        const recipe = Array.isArray(result.recipeInstructions) ? result.recipeInstructions.map((instruction, index) => 
                            `${index + 1}. ${instruction.text}`) : [];

                        return {
                            name: foodName,
                            image: foodImg,
                            author: author,
                            description: description,
                            ingredients: ingredient,
                            recipeImg: recipeImg,
                            recipe: recipe
                        };
                    } else {
                        console.log("HTTP response error:", newResponse.status);
                        return null;
                    }
                });

                const resolvedPromises = await Promise.all(promises);
                results.push(...resolvedPromises.filter(result => result !== null));
            } else {
                console.log("HTTP response error:", response.status);
            }

            return results;
        }

        function go_top() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    </script>
    <script src="https://developers.kakao.com/sdk/js/kakao.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const kakaoNickname = localStorage.getItem('kakaoNickname');
            if (kakaoNickname) {
                document.getElementById('login-menu').style.display = 'none';
                const userNameMenu = document.getElementById('user-name-menu');
                userNameMenu.style.display = 'block';
                const userNameElement = document.getElementById('user-name');
                userNameElement.textContent = kakaoNickname;
    
                // 로그인 메뉴와 동일한 스타일 적용
                userNameElement.style.color = '#fff';
                userNameElement.style.fontFamily = 'Work Sans, sans-serif';
                userNameElement.style.fontSize = '1rem';
                userNameElement.style.textDecoration = 'none';
            }
        });
    </script>
    <!-- Preloader -->
    <div id="overlayer"></div>
    <div class="loader">
    	<div class="spinner-border" role="status">
    		<span class="visually-hidden">Loading...</span>
    	</div>
    </div>
    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="js/tiny-slider.js"></script>
    <script src="js/aos.js"></script>
    <script src="js/navbar.js"></script>
    <script src="js/counter.js"></script>
    <script src="js/custom.js"></script>
	<script src="https://developers.kakao.com/sdk/js/kakao.min.js"></script>
	<script src="5_recipe.js"></script>
</body>
</html>
